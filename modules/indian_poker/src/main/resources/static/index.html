<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>game-hub/IndianPoker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" href="https://cdn.simpleicons.org/github/ffffff" type="image/svg+xml">

    <link rel="stylesheet" href="/style.css">
    <style>
        /* [1] ê³µí†µ ìœ í‹¸ë¦¬í‹° */
        .hidden { display: none !important; }
        body { color: var(--text-primary); background-color: var(--bg-body); }

        /* ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .box {
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--box-bg);
            color: var(--text-primary);
            overflow: hidden;
            margin-bottom: 20px;
        }
        .box-header {
            background-color: var(--bg-header);
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600; font-size: 14px;
            color: var(--text-primary);
            display: flex; justify-content: space-between; align-items: center;
        }

        /* ì…ë ¥ì°½ */
        input[type="text"] {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            width: 100%;
            box-sizing: border-box;
            background-color: var(--input-bg, #ffffff);
            color: var(--text-primary);
            font-size: 14px;
        }

        /* [2] ê²Œì„ í™”ë©´ ë ˆì´ì•„ì›ƒ (ì±„íŒ… ì „ì†¡ë²„íŠ¼ ì„¸ë¡œ ë¬¸ì œ í•´ê²°ë¨) */
        .game-layout { display: flex; gap: 20px; height: 600px; margin-top: 10px; }

        .game-stage {
            flex: 3;
            background-color: var(--box-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            position: relative;
            overflow: hidden;
            display: flex; flex-direction: column;
        }

        .chat-container {
            flex: 1;
            display: flex; flex-direction: column;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--box-bg);
            color: var(--text-primary);
            min-width: 280px;
        }

        #messages { flex: 1; overflow-y: auto; padding: 10px; font-size: 13px; background: transparent; }
        .msg-item { padding: 4px 0; border-bottom: 1px solid var(--border-color); }
        .msg-system { background-color: var(--bg-header); padding: 8px; border-radius: 6px; text-align: center; margin: 5px 0; color: var(--text-secondary); font-size: 12px; }

        /* [3] â˜… ì¸ë””ì–¸ í¬ì»¤ ë³´ë“œ (GitHub í…Œë§ˆ ì ìš© + í•œê¸€) â˜… */
        .poker-board {
            width: 100%; height: 100%;
            /* ì´ˆë¡ìƒ‰ ì œê±° -> í…Œë§ˆ ë°°ê²½ìƒ‰ ì‚¬ìš© */
            background-color: var(--bg-body);
            /* ì€ì€í•œ ê²©ìë¬´ëŠ¬ íŒ¨í„´ (ê°œë°œì ê°ì„±) */
            background-image: radial-gradient(var(--border-color) 1px, transparent 1px);
            background-size: 20px 20px;

            display: flex; flex-direction: column; justify-content: space-between;
            padding: 20px; box-sizing: border-box;
            color: var(--text-primary);
        }

        .opponents-area {
            display: flex; justify-content: center; gap: 15px;
            flex-wrap: wrap; align-content: flex-start;
            border-bottom: 1px dashed var(--border-color); /* ì ì„  êµ¬ë¶„ */
            padding: 15px;
            min-height: 170px; margin: 0 10px;
            overflow-y: auto;
        }

        /* í”Œë ˆì´ì–´ ë°•ìŠ¤: ê¹ƒí—ˆë¸Œ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .opponent-box {
            background-color: var(--box-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            width: 110px; padding: 10px;
            display: flex; flex-direction: column; align-items: center;
            position: relative; transition: all 0.2s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        /* í„´ í™œì„±í™”: íŒŒë€ìƒ‰ í…Œë‘ë¦¬ (ê¹ƒí—ˆë¸Œ í¬ì»¤ìŠ¤) */
        .opponent-box.active-turn {
            border-color: var(--link-color);
            box-shadow: 0 0 0 2px var(--link-color);
            z-index: 5;
        }

        .opponent-box.player-die { opacity: 0.5; filter: grayscale(100%); }
        .opponent-name {
            font-size: 13px; margin-bottom: 2px; font-weight: 600;
            color: var(--text-primary);
            width: 100%; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        .my-area {
            border-top: 1px dashed var(--border-color); /* ì ì„  êµ¬ë¶„ */
            background: transparent;
            padding: 20px; margin: 0 -20px -20px -20px;
            display: flex; flex-direction: column; align-items: center;
        }

        /* [4] â˜… ì¹´ë“œ ë””ìì¸ (ê·€í‰ì´ ë²Œë¦¬ê¸° + ê¹”ë”í•œ ìŠ¤íƒ€ì¼) â˜… */
        .card-area { width: 70px; height: 100px; perspective: 1000px; display: inline-block; margin: 0 5px; cursor: pointer; }
        .card {
            width: 100%; height: 100%; position: relative;
            transform-style: preserve-3d; transition: transform 0.6s;
            background: white; border-radius: 6px;
            border: 1px solid var(--border-color);
            color: #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .card.flipped { transform: rotateY(180deg); }

        .card-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden;
            display: block; padding: 0;
            font-family: 'Courier New', monospace; font-weight: bold;
            background: white; border-radius: 6px;
        }
        .card.red .card-face { color: #d73a49; }
        .card.black .card-face { color: #24292f; }

        /* ìˆ«ì/ë¬¸ì–‘ êµ¬ì„ìœ¼ë¡œ ë°°ì¹˜ */
        .card-top { position: absolute; top: 4px; left: 4px; font-size: 14px; line-height: 1; display: flex; flex-direction: column; align-items: center; }
        .card-center { font-size: 32px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .card-bottom { position: absolute; bottom: 4px; right: 4px; font-size: 14px; line-height: 1; display: flex; flex-direction: column; align-items: center; transform: rotate(180deg); }

        /* ì¹´ë“œ ë’·ë©´: ê¹ƒí—ˆë¸Œ ëŠë‚Œ íŒ¨í„´ */
        .card-back {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; transform: rotateY(180deg);
            background-color: #24292f;
            background-image: repeating-linear-gradient(45deg, #24292f 0, #24292f 10px, #2f363d 10px, #2f363d 20px);
            border-radius: 6px; border: 2px solid white; box-sizing: border-box;
        }
        .chip-badge {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: normal;
        }
        /* [5] ë²„íŠ¼ ë° ìœ í‹¸ë¦¬í‹° */
        button { cursor: pointer; border: 1px solid var(--border-color); padding: 6px 14px; border-radius: 6px; font-weight: 600; font-size: 13px; }
        .btn-primary { background-color: var(--btn-primary-bg, #2da44e); color: var(--btn-primary-text, white); border: 1px solid rgba(27,31,35,0.15); }
        .btn-danger { background-color: var(--box-bg); color: #cf222e; border-color: var(--border-color); }
        .btn-danger:hover { background-color: #cf222e; color: white; }
        .btn-default { background-color: var(--btn-bg); color: var(--text-primary); }

        /* ê²Œì„ìš© ë²„íŠ¼ (í‰ë©´ ë””ìì¸) */
        .btn-game { padding: 10px 25px; border-radius: 6px; font-size: 14px; margin: 0 5px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .btn-game:active { transform: translateY(1px); }
        .btn-go { background: #2da44e; color: white; border: 1px solid rgba(27,31,35,0.15); }
        .btn-die { background: #cf222e; color: white; border: 1px solid rgba(27,31,35,0.15); }

        #turn-alert { color: var(--link-color); font-weight:bold; margin-top:10px; font-size: 14px; min-height: 24px; text-align:center;}
        .room-item { padding: 12px 16px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; cursor: pointer;}

        /* ì „ì†¡ ë²„íŠ¼ ì°Œê·¸ëŸ¬ì§ ë°©ì§€ */
        .btn-send { white-space: nowrap; flex-shrink: 0; min-width: 50px; }
    </style>
</head>
<body>

<header>
    <div class="repo-breadcrumb">
        <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" width="30" style="border-radius:50%; opacity:1;">
        <a href="/static" class="user-name">game-hub</a>
        <span style="color:var(--text-primary)">/</span>
        <a href="#" class="repo-name">IndianPoker</a>
        <span class="badge">Public</span>
    </div>
    <button class="theme-btn" onclick="Core.toggleTheme()">Dark/Light</button>
</header>

<div id="alert-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:2000;">
    <div class="box" style="width:320px; box-shadow: 0 8px 24px rgba(0,0,0,0.1);">
        <div class="box-header">ì•Œë¦¼</div>
        <div style="padding: 20px; text-align: center;"><p id="alert-msg-text" style="margin: 0;">ë©”ì‹œì§€</p></div>
        <div style="padding:16px; border-top: 1px solid var(--border-color); background:var(--bg-header);">
            <button class="btn-primary" onclick="Core.closeAlert()" style="width: 100%;">í™•ì¸</button>
        </div>
    </div>
</div>

<div id="login-screen" class="container" style="max-width: 400px; margin-top: 50px;">
    <div class="box">
        <div class="box-header">ë¡œê·¸ì¸</div>
        <div style="padding: 20px;">
            <label style="display:block; margin-bottom:8px; font-weight:600; font-size:14px;">ë‹‰ë„¤ì„</label>
            <input type="text" id="nicknameInput" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" onkeypress="if(event.key==='Enter') Core.login()">
            <button class="btn-primary" onclick="Core.login()" style="width:100%; margin-top:16px;">ì…ì¥í•˜ê¸°</button>
        </div>
    </div>
</div>

<div id="lobby-screen" class="container hidden">
    <div class="box">
        <div class="box-header">ëŒ€ê¸°ì‹¤ <span id="welcome-msg" style="font-size:12px; font-weight:normal;"></span></div>
        <div style="padding: 16px; display:flex; gap:10px;">
            <input type="text" id="roomNameInput" placeholder="ë°© ì œëª©" value="ìƒˆë¡œìš´ ê²Œì„ë°©" style="flex:2;">
            <div id="game-options-area"></div>
            <button class="btn-primary" onclick="Core.createRoom()">ë°© ë§Œë“¤ê¸°</button>
        </div>
        <div style="max-height: 400px; overflow-y: auto;">
            <div style="padding: 10px 16px; background:var(--bg-header); border-bottom:1px solid var(--border-color); display:flex; justify-content:space-between;">
                <span>ë°© ëª©ë¡</span>
                <button class="btn-default" onclick="Core.loadRooms()" style="font-size:12px;"><i class="fas fa-sync-alt"></i> ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <ul id="room-list" style="list-style: none; padding: 0; margin: 0;"></ul>
        </div>
    </div>
</div>

<div id="game-screen" class="container hidden">
    <div style="display:flex; justify-content:space-between; margin-bottom:16px; align-items:center;">
        <div style="display:flex; align-items:center; gap:8px;">
            <strong id="room-title-text" style="font-size: 18px;">ë°© ì œëª©</strong>
            <span id="game-status" class="badge">ì§„í–‰ ì¤‘</span>
        </div>
        <div>
            <button id="startBtn" class="btn-primary" onclick="Core.startGame()">ê²Œì„ ì‹œì‘</button>
            <button class="btn-danger" onclick="Core.exitRoom()">ë‚˜ê°€ê¸°</button>
        </div>
    </div>

    <div class="game-layout">
        <div id="game-stage" class="game-stage">
            <div id="indian-poker-board" class="poker-board hidden">
                <div style="text-align:center; font-size:12px; color:var(--text-secondary); margin-bottom:5px;">â–¼ ìƒëŒ€ë°© (Opponents)</div>
                <div id="opponents-grid" class="opponents-area">
                    <span style="color:var(--text-secondary); line-height:140px;">ëŒ€ê¸° ì¤‘...</span>
                </div>

                <div class="my-area">
                    <div style="font-weight:bold; margin-bottom:10px; color:var(--text-primary);">ë‚˜ (Me)</div>
                    <div id="my-card-area" style="display:flex; justify-content:center; height:120px;"></div>

                    <div id="bet-btns" style="margin-top:15px; visibility:hidden;">
                        <button class="btn-game btn-go" onclick="IndianPoker.bet('GO')">GO</button>
                        <button class="btn-game btn-die" onclick="IndianPoker.bet('DIE')">DIE</button>
                    </div>
                    <div id="turn-alert"></div>
                </div>
            </div>
        </div>

        <div class="chat-container">
            <div class="box-header" style="padding:10px;">ğŸ’¬ ì±„íŒ…</div>
            <div id="messages"></div>
            <div style="padding: 10px; border-top: 1px solid var(--border-color); display:flex; gap:8px;">
                <input type="text" id="chatInput" placeholder="ì…ë ¥..." onkeypress="if(event.key==='Enter') Core.sendChat()">
                <button class="btn-primary btn-send" onclick="Core.sendChat()">ì „ì†¡</button>
            </div>
        </div>
    </div>
</div>

<div id="ranking-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:999;">
    <div class="box" style="width:360px; text-align: center; box-shadow: 0 8px 24px rgba(0,0,0,0.2);">
        <div class="box-header">ğŸ† ê²Œì„ ê²°ê³¼</div>
        <div style="padding: 30px 20px;">
            <div style="font-size:40px; margin-bottom:10px;">ğŸ‰</div>
            <div id="winnerName" style="font-size:20px; font-weight:bold;">WINNER</div>
        </div>
        <div style="padding:16px; border-top: 1px solid var(--border-color); background:var(--bg-header);">
            <button class="btn-primary" onclick="Core.closeRanking()" style="width: 100%;">í™•ì¸</button>
        </div>
    </div>
</div>

<script src="/indian_poker/js/game-core.js"></script>
<script src="/indian_poker/js/card-core.js"></script>
<script src="/indian_poker/js/indian_poker.js"></script>

</body>
</html>